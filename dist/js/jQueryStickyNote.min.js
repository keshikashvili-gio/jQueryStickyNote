window.note={},+function($){"use strict";note.Note=function(container,data){console.log(data),this.$container=$(container),this.id=data.id,this.width=data.width,this.height=data.height,this.x=data.x,this.y=data.y,this.theme=data.theme,this.text=data.text,this.$note=null,this.init()},note.Note.prototype={constructor:note.Note,init:function(){this.createNote()},createNote:function(){return this.$note=$(this.getHtml(this.id,this.theme,this.width,this.height,this.x,this.y,this.text)),this},getNote:function(){return this.$note},run:function(){this.$container.append(this.getNote())},getHtml:function(id,theme,width,height,x,y,text){return'<div id="note-'+id+'" class="jquery-sticky-note theme-'+theme+'" style="width:'+width+"px;height:"+height+"px;left:"+x+"px;top:"+y+'px;"><div class="sticky-note-header"><a href="javascript:" class="add-new-note">+</a><a href="javascript:" class="remove-note">x</a></div><div class="sticky-note-body">'+text+"</div></div>"}}}(jQuery),window.note=window.note||{},+function(){"use strict";note.DbService=function(){},note.DbService.prototype={constructor:note.DbService,save:function(){console.error("SAVE method must be implemented in your DbService class")},"delete":function(){console.error("DELETE method must be implemented in your DbService class")},deleteAll:function(){console.error("DELETEALL method must be implemented in your DbService class")},update:function(){console.error("UPDATE method must be implemented in your DbService class")},updateAll:function(){console.error("UPDATEALL method must be implemented in your DbService class")},getData:function(){console.error("GETDATA method must be implemented in your DbService class")}}}(jQuery),window.note=window.note||{},+function($){"use strict";note.DbLocalStorageService=function(options){this.options=options},note.DbLocalStorageService.prototype=Object.create(note.DbService.prototype),note.DbLocalStorageService.prototype.constructor=note.DbLocalStorageService,note.DbLocalStorageService.prototype.save=function(newData){var data=this._getAllFromLocalStorage();newData.id=parseInt(this._getMaxId()+1),data.push(newData),this._saveToLocalStorage(data)},note.DbLocalStorageController.prototype["delete"]=function(id){for(var data=this._getAllFromLocalStorage(),i=0;i<data.length;i++)data[i].id==id&&data.splice(data[i],1);this._saveToLocalStorage(data)},note.DbLocalStorageService.prototype.deleteAll=function(){},note.DbLocalStorageController.prototype.update=function(updatedData){for(var data=this._getAllFromLocalStorage(),i=0;i<data.length;i++)data[i].id==updatedData.id&&(data[i]=updatedData);this._saveToLocalStorage(data)},note.DbLocalStorageService.prototype.updateAll=function(){},note.DbLocalStorageController.prototype.getData=function(){return this._getAllFromLocalStorage()},note.DbLocalStorageController.prototype._getAllFromLocalStorage=function(){var storage=localStorage.getItem(this.options.localStorageKey);return storage?JSON.parse(storage):[]},note.DbLocalStorageController.prototype._saveToLocalStorage=function(data){localStorage.setItem(this.options.localStorageKey,JSON.stringify(data))},note.DbLocalStorageController.prototype._getItemFromLocalStorage=function(key){return this._getAllFromLocalStorage()[key]},note.DbLocalStorageService.prototype._getMaxId=function(){var max=0;return $.each(this.getData(),function(index,item){item.id>max&&(max=item.id)}),max}}(jQuery),window.note=window.note||{},+function($){"use strict";note.DbBackendService=function(options){this.options=options,this.data={}},note.DbBackendService.prototype=Object.create(note.DbService.prototype),note.DbBackendService.prototype.constructor=note.DbBackendService,note.DbBackendService.prototype.save=function(data){var self=this;return this._post(this.options.postUrl,data).done(function(res){return res.success?void(self.data=res.data):res.errorMsg}),self.data},note.DbBackendService.prototype["delete"]=function(){},note.DbBackendService.prototype.deleteAll=function(){},note.DbBackendService.prototype.update=function(){},note.DbBackendService.prototype.updateAll=function(){},note.DbBackendService.prototype.getData=function(){var self=this;return this._get(this.options.loadUrl).done(function(data){self.data=data}),self.data},note.DbBackendService.prototype._get=function(url,data){return $.ajax({url:url,type:"GET",data:data})},note.DbBackendService.prototype._post=function(url,data){return $.ajax({url:url,type:"POST",data:data})}}(jQuery),window.note=window.note||{},+function($){"use strict";note.NoteManager=function(element,options){this.options=options,this.$element=$(element),this.notes={},this.dbService={},this.maxId=1,this.init()},note.NoteManager.prototype={constructor:note.NoteManager,init:function(){console.log("init");var savedData,self=this;self.options=$.extend({},note.NoteManager.DEFAULTS,self.options),"dbLocalStorageService"===self.options.dbService?self.dbService=new note.DbLocalStorageService(self.options.dbLocalStorageOptions):"dbBackendService"===self.options.dbService&&(self.dbService=new note.DbBackendService(self.options.dbBackendOptions)),savedData=self.dbService.getData(),savedData.length?self.notes=savedData:(self.notes=self.options.plainNoteObject,self.dbService.save(self.notes[0])),$.each(self.notes,function(i,item){self.createNote(item)})},bindEvents:function($element){$element.find(".add-new-note").on("click",this.openNewNote.bind(this)),$element.find(".remove-note").on("click",this.removeNote.bind(this))},openNewNote:function(){this.createNote(this.options.plainNoteObject[0]),this.dbService.save(this.options.plainNoteObject[0])},createNote:function(object){var Note=new note.Note(this.$element,object);this.bindEvents(Note.$note),this.initDrag(Note.$note,this.$element),Note.run()},removeNote:function(event){var note=$(event.target).parents(".jquery-sticky-note");console.log(note),$(note).remove(),this.dbService["delete"](note)},getMaxId:function(){return++this.maxId},toObject:function(){},initDrag:function(){var self=this;interact(".jquery-sticky-note").draggable({onmove:self.dragMoveListener.bind(this),inertia:!0,restrict:{restriction:"parent",endOnly:!0,elementRect:{top:0,left:0,bottom:1,right:1}},autoScroll:!0,onend:function(event){var textEl=event.target.querySelector("p");textEl&&(textEl.textContent="moved a distance of "+(0|Math.sqrt(event.dx*event.dx+event.dy*event.dy))+"px")}}).resizable({preserveAspectRatio:!0,edges:{left:!0,right:!0,bottom:!0,top:!0}}).on("resizemove",self.resizeListener.bind(this))},dragMoveListener:function(event){console.log("beforeMove");var target=event.target,x=(parseFloat(target.getAttribute("data-x"))||0)+event.dx,y=(parseFloat(target.getAttribute("data-y"))||0)+event.dy;target.style.webkitTransform=target.style.transform="translate("+x+"px, "+y+"px)",target.setAttribute("data-x",x),target.setAttribute("data-y",y),console.log("afterMove")},resizeListener:function(event){console.log("beforeResize");var target=event.target,x=parseFloat(target.getAttribute("data-x"))||0,y=parseFloat(target.getAttribute("data-y"))||0;target.style.width=event.rect.width+"px",target.style.height=event.rect.height+"px",x+=event.deltaRect.left,y+=event.deltaRect.top,target.style.webkitTransform=target.style.transform="translate("+x+"px,"+y+"px)",target.setAttribute("data-x",x),target.setAttribute("data-y",y),console.log("afterResize")}},note.NoteManager.THEMES=["blue","green","pink","purple","white","yellow"],note.NoteManager.DEFAULTS={plainNoteObject:[{id:1,width:180,height:166,x:300,y:100,text:"",theme:"yellow"}],dbService:"dbLocalStorageService",dbLocalStorageOptions:{localStorageKey:"_jq_sticky_note"},dbBackendOptions:{loadUrl:"",saveUrl:"",updateUrl:"",deleteUrl:"",deleteAllUrl:""}},jQuery.fn.jQueryStickyNote=function(options){return new note.NoteManager(this,options)}}(jQuery);