window.note=window.note||{},+function(){"use strict";note.ContextMenu=function(menuItems,options){this.menuItems=menuItems,this.option=$.extend({},note.ContextMenu.OPTIONS,options),$("body").append(this.getMenuHtml(this.menuItems)),this.contextMenuClassName="context-menu",this.contextMenuItemClassName="context-menu__item",this.contextMenuLinkClassName="context-menu__link",this.contextMenuActive="context-menu--active",this.taskItemClassName="jquery-sticky-note",this.taskItemInContext="",this.clickCoords=0,this.clickCoordsX=0,this.clickCoordsY=0,this.menu=document.querySelector("#context-menu"),this.menuItems=this.menu.querySelectorAll(".context-menu__item"),this.menuState=0,this.menuWidth=0,this.menuHeight=0,this.menuPosition=0,this.menuPositionX=0,this.menuPositionY=0,this.windowWidth=0,this.windowHeight=0,this.init()},note.ContextMenu.OPTIONS={itemClickCallback:function(){},menuOwnerActiveClass:".context-menu-open"},note.ContextMenu.prototype={constructor:note.ContextMenu,init:function(){this.contextListener(),this.clickListener(),this.keyupListener(),this.resizeListener()},contextListener:function(){var self=this;document.addEventListener("contextmenu",function(e){self.taskItemInContext=self.clickInsideElement(e,self.taskItemClassName),self.taskItemInContext?(e.preventDefault(),self.toggleMenuOn(),self.positionMenu(e),$(self.taskItemInContext).addClass(self.option.menuOwnerActiveClass),console.log("open")):(self.taskItemInContext=null,self.toggleMenuOff(),console.log("close"))})},clickListener:function(){var self=this;document.addEventListener("click",function(e){var clickElIsLink=self.clickInsideElement(e,self.contextMenuLinkClassName);if(clickElIsLink)e.preventDefault(),self.menuItemListener(e,clickElIsLink);else{var button=e.which||e.button;1===button&&self.toggleMenuOff()}})},keyupListener:function(){var self=this;window.onkeyup=function(e){27===e.keyCode&&self.toggleMenuOff()}},resizeListener:function(){var self=this;window.onresize=function(){self.toggleMenuOff()}},toggleMenuOn:function(){1!==this.menuState&&(this.menuState=1,this.menu.classList.add(this.contextMenuActive))},toggleMenuOff:function(){0!==this.menuState&&(this.menuState=0,this.menu.classList.remove(this.contextMenuActive),$(this.option.menuOwnerActiveClass).removeClass(this.option.menuOwnerActiveClass))},positionMenu:function(e){this.clickCoords=this.getPosition(e),this.clickCoordsX=this.clickCoords.x,this.clickCoordsY=this.clickCoords.y,this.menuWidth=this.menu.offsetWidth+4,this.menuHeight=this.menu.offsetHeight+4,this.windowWidth=window.innerWidth,this.windowHeight=window.innerHeight,this.menu.style.left=this.windowWidth-this.clickCoordsX<this.menuWidth?this.windowWidth-this.menuWidth+"px":this.clickCoordsX+"px",this.menu.style.top=this.windowHeight-this.clickCoordsY<this.menuHeight?this.windowHeight-this.menuHeight+"px":this.clickCoordsY+"px"},menuItemListener:function(e,link){if("function"==typeof this.option.itemClickCallback){var menuOwner=$(this.option.menuOwnerActiveClass);this.option.itemClickCallback.call(null,e,link,menuOwner)}this.toggleMenuOff()},clickInsideElement:function(e,className){var el=e.srcElement||e.target;if(el.classList.contains(className))return el;for(;el=el.parentNode;)if(el.classList&&el.classList.contains(className))return el;return!1},getPosition:function(e){var posx=0,posy=0;return e||(e=window.event),e.pageX||e.pageY?(posx=e.pageX,posy=e.pageY):(e.clientX||e.clientY)&&(posx=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,posy=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:posx,y:posy}},getMenuHtml:function(menuItems){for(var html='<nav id="context-menu" class="context-menu"><ul class="context-menu__items">',i=0;i<menuItems.length;i++)html+='<li class="context-menu__item"><a href="#" class="context-menu__link" data-key="'+menuItems[i].name+'" data-value="'+menuItems[i].value+'"><span style="background-color:'+menuItems[i].value+'"></span>'+menuItems[i].name+"</a></li>";return html+="</ul></nav>"}}}();