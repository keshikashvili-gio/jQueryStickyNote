window.note=window.note||{},+function($){"use strict";note.NoteManager=function(element,options){this.options=options,this.$element=$(element),this.notes={},this.dbService={},this.maxId=1,this.init()},note.NoteManager.prototype={constructor:note.NoteManager,init:function(){console.log("init");var savedData,self=this;self.options=$.extend({},note.NoteManager.DEFAULTS,self.options),"dbLocalStorageService"===self.options.dbService?self.dbService=new note.DbLocalStorageService(self.options.dbLocalStorageOptions):"dbBackendService"===self.options.dbService&&(self.dbService=new note.DbBackendService(self.options.dbBackendOptions)),savedData=self.dbService.getData(),savedData.length?self.notes=savedData:(self.notes=self.options.plainNoteObject,self.dbService.save(self.notes[0])),$.each(self.notes,function(i,item){self.createNote(item)})},bindEvents:function($element){$element.find(".add-new-note").on("click",this.openNewNote.bind(this)),$element.find(".remove-note").on("click",this.removeNote.bind(this))},openNewNote:function(){this.createNote(this.options.plainNoteObject[0]),this.dbService.save(this.options.plainNoteObject[0])},createNote:function(object){var Note=new note.Note(this.$element,object);this.bindEvents(Note.$note),this.initDrag(Note.$note,this.$element),Note.run()},removeNote:function(event){var note=$(event.target).parents(".jquery-sticky-note");console.log(note),$(note).remove(),this.dbService["delete"](note)},getMaxId:function(){return++this.maxId},toObject:function(){},initDrag:function(){var self=this;interact(".jquery-sticky-note").draggable({onmove:self.dragMoveListener.bind(this),inertia:!0,restrict:{restriction:"parent",endOnly:!0,elementRect:{top:0,left:0,bottom:1,right:1}},autoScroll:!0,onend:function(event){var textEl=event.target.querySelector("p");textEl&&(textEl.textContent="moved a distance of "+(0|Math.sqrt(event.dx*event.dx+event.dy*event.dy))+"px")}}).resizable({preserveAspectRatio:!0,edges:{left:!0,right:!0,bottom:!0,top:!0}}).on("resizemove",self.resizeListener.bind(this))},dragMoveListener:function(event){console.log("beforeMove");var target=event.target,x=(parseFloat(target.getAttribute("data-x"))||0)+event.dx,y=(parseFloat(target.getAttribute("data-y"))||0)+event.dy;target.style.webkitTransform=target.style.transform="translate("+x+"px, "+y+"px)",target.setAttribute("data-x",x),target.setAttribute("data-y",y),console.log("afterMove")},resizeListener:function(event){console.log("beforeResize");var target=event.target,x=parseFloat(target.getAttribute("data-x"))||0,y=parseFloat(target.getAttribute("data-y"))||0;target.style.width=event.rect.width+"px",target.style.height=event.rect.height+"px",x+=event.deltaRect.left,y+=event.deltaRect.top,target.style.webkitTransform=target.style.transform="translate("+x+"px,"+y+"px)",target.setAttribute("data-x",x),target.setAttribute("data-y",y),console.log("afterResize")}},note.NoteManager.THEMES=["blue","green","pink","purple","white","yellow"],note.NoteManager.DEFAULTS={plainNoteObject:[{id:1,width:180,height:166,x:300,y:100,text:"",theme:"yellow"}],dbService:"dbLocalStorageService",dbLocalStorageOptions:{localStorageKey:"_jq_sticky_note"},dbBackendOptions:{loadUrl:"",saveUrl:"",updateUrl:"",deleteUrl:"",deleteAllUrl:""}},jQuery.fn.jQueryStickyNote=function(options){return new note.NoteManager(this,options)}}(jQuery);